<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visualiseur 3D GPS</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://unpkg.com/maplibre-gl@4.7.0/dist/maplibre-gl.css" rel="stylesheet" />
</head>
<body>

  <header>
    <div class="hamburger">â˜°</div>
    <nav class="menu">
      <ul>
        <li><a href="#" class="menu-link active" data-page="accueil">Chargement</a></li>
        <li><a href="#" class="menu-link" data-page="playeur">â–¶ï¸ Playeur</a></li>
        <li><a href="#" class="menu-link" data-page="export">ğŸ’¾ Export</a></li>
      </ul>
    </nav>
  </header>

  <!-- Page de chargement -->
  <div id="page-accueil" class="page active">
    <h1>ğŸ—ºï¸ Visualiseur 3D GPS</h1>
    <div class="dropzone-container">
      <div class="dropzone">
        <p>Importez une trace KML, IGC, GPX, TCX</p>
      </div> 
    </div>  
  </div>

  <!-- Page affiche carte -->
  <div id="page-carte" class="page">
    <div class="carte-container">
      <div id="map" class="mapzone"></div>
    </div>
    <div class="debug-info">Initialisation de la carte...</div>  
  </div>

  <!-- Page playeur -->
  <div id="page-playeur" class="page">  
    <div class="playeur-container">
      <div id="map-playeur" class="mapzone"></div>
	        
      <!-- ContrÃ´les gauche -->     
      <div class="controls controls-left">
        <div class="control-group"> 
          <label>Ã‰paisseur: <span id="traceWidthValue">4.0</span>px</label>
          <input type="range" id="traceWidth" min="1" max="20" step="0.5" value="4">
        </div>
        <div class="control-group"> 
          <label>Couleur : &#127752;</label>
          <input type="color" id="traceColor" value="#ff0000">
        </div>
        <div class="control-group">
          <label>OpacitÃ©: <span id="traceOpacityValue">0.90</span></label>
          <input type="range" id="traceOpacity" min="0" max="1" step="0.05" value="0.9">
        </div>
        <div class="control-group">
          <label>Moyen : <span id="mobileIconValue">ğŸš¶</span></label>
          <select id="mobileSelector" class="mobile-selector">
            <option value="ğŸš¶">ğŸš¶ Rando</option>
            <option value="ğŸ¥¾">ğŸ¥¾ Marche</option>		
            <option value="ğŸš´">ğŸš´ VÃ©lo</option>
            <option value="ğŸš—">ğŸš— Voiture</option>
            <option value="ğŸï¸">ğŸï¸ Moto</option>
            <option value="ğŸš¤">ğŸš¤ï¸ Bateau</option>	
            <option value="â›·ï¸">â›·ï¸ Ski</option>
            <option value="ğŸª‚">ğŸª‚ Parapente</option>
            <option value="ğŸ‡ğŸ¼">ğŸ‡ğŸ¼ Ã‰quitation</option>
          </select>
        </div>
      </div>
 
<!-- ContrÃ´les droite -->
<div class="controls controls-right">
  <!-- Groupe 2: Ã‰chelle Z -->
  <div class="control-group">
    <label>ğŸ”ï¸ Ã‰chelle Z : <span id="zScaleValue">1.5</span></label>
    <input type="range" id="zScale" min="0" max="5" step="0.1" value="1.5">
  </div>
        
  <!-- Groupe 3: SÃ©lection carte -->
  <div class="control-group">
    <label for="mapStyleSelect">ğŸ—ºï¸ Carte</label>
    <select id="mapStyleSelect">
      <option value="hybrid">ğŸŒ Hybride (satellite + routes)</option>
      <option value="streets">ğŸ›£ï¸ Routes</option>
      <option value="topo">â›°ï¸ Topographique</option>
      <option value="outdoor">ğŸï¸ ExtÃ©rieur</option>
      <option value="toner">ğŸ–¤ Toner (N&B)</option>
    </select>
  </div>
        
  <!-- GROUPE PLAYEUR avec boÃ®te ğŸ‘£ -->
  <div class="control-group-with-box">
    <span class="control-group-title">ğŸš²</span>
    <div class="player-controls">
      <button class="ctrl-btn" title="Retour au dÃ©but">â®ï¸</button>
      <button class="ctrl-btn" title="Lecture/Pause">â–¶ï¸</button>
      <button class="ctrl-btn" title="Avance rapide">â­ï¸</button>
      <button class="ctrl-btn" title="Boucle">ğŸ”</button>
    </div>
  </div>

  <!-- GROUPE CAMÃ‰RA avec boÃ®te ğŸ¥ -->
  <div class="control-group-with-box">
    <span class="control-group-title">ğŸ‘ï¸</span>
    <div class="additional-controls">
      <button class="add-ctrl-btn" id="pitchCycleBtn" data-tooltip="Monte/baisse">ğŸ”€</button>
      <button class="add-ctrl-btn" id="rotationBtn" data-tooltip="Panoramique">ğŸ”„</button>
      <button class="add-ctrl-btn" id="speedUpBtn" data-tooltip="AccÃ©lÃ©rer">â©</button>
      <button class="add-ctrl-btn" id="slowDownBtn" data-tooltip="DÃ©cÃ©lÃ©rer">âª</button>
    </div> 		
  </div>

  <!-- Groupe compact Vol + Actualiser - DÃ‰CALÃ‰ VERS LE BAS -->
  <div class="control-group compact-group">
    <!-- Toggle Vol  -->
    <div class="toggle-container">
      <div class="toggle-switch">
        <input type="checkbox" id="volToggle" class="toggle-checkbox">
        <label for="volToggle" class="toggle-label">
          <span class="toggle-inner"></span>
          <span class="toggle-switch"></span>
        </label>
      </div>
  
    </div>
   
    <!-- Bouton Actualiser -->
    <div class="button-container">
      <button id="forceRefreshBtn" class="icon-button" title="RafraÃ®chir la trace (F5)">
        ğŸ”„
      </button>
   
    </div>
  </div>
</div>
 </div>
    </div>

  <!-- Page Export - CORRIGÃ‰E : EN DEHORS DE LA PAGE PLAYEUR -->
  <div id="page-export" class="page">
    <h1>Export Trace</h1>
    <p style="text-align: center;">
      Vous pouvez sÃ©lectionner le texte et l'exporter ou directement au format dÃ©sirÃ©.
    </p>
    
    <!-- DÃ©but des boutons d'exportation -->
    <div class="export-buttons">
      <a href="#" class="export-button gpx">
        <img src="ImagesPourconversions/ExportGPX.png" alt="Exporter en GPX" class="normal">
        <img src="ImagesPourconversions/ExportGPX_hover.png" alt="Exporter en GPX (hover)" class="hover">
      </a>
      <a href="#" class="export-button igc">
        <img src="ImagesPourconversions/ExportIGC.png" alt="Exporter en IGC" class="normal">
        <img src="ImagesPourconversions/ExportIGC_hover.png" alt="Exporter en IGC (hover)" class="hover">
      </a>
      <a href="#" class="export-button kml">
        <img src="ImagesPourconversions/ExportKML.png" alt="Exporter en KML" class="normal">
        <img src="ImagesPourconversions/ExportKML_hover.png" alt="Exporter en KML (hover)" class="hover">
      </a>
    </div>
    <!-- Fin des boutons d'exportation -->

    <div class="textarea-container">
      <textarea id="trace-content" rows="15" style="width: 90%; font-size: 1.2em;" readonly></textarea>
    </div>
    
  </div>

  <!-- Librairies externes -->
  <script src="https://unpkg.com/maplibre-gl@4.7.0/dist/maplibre-gl.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://unpkg.com/@mapbox/togeojson@latest/togeojson.js"></script>
  <script src="conversion_trace.js"></script> 
  <script src="traceVolante.js"></script>
  <script src="Script.js"></script>


  <script>
  // Script pour gÃ©rer l'Ã©tat du bouton basculant
  document.addEventListener('DOMContentLoaded', function() {
    const volToggle = document.getElementById('volToggle');
    
    // Initialisation Ã  "Non" par dÃ©fautxxÂ²
    volToggle.checked = false;
    
    // Mise Ã  jour quand le bouton est basculÃ©
    volToggle.addEventListener('change', function() {
      if (this.checked) {
        // Mode Vol activÃ©
        console.log("Vol: Oui");
      } else {
        // Mode Vol dÃ©sactivÃ©
        console.log("Vol: Non");
      }
    });
  });
  </script>
</body>
</html>
